<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../glg-current-user/glg-current-user.html" />

<link rel="import" href="../../bower_components/paper-styles/paper-styles.html">
<link rel="import" href="../../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="glg-avatar">
  <style>

    :host {
      display: block;
    }

    avatar {
      display: inline-flex;
      align-content: center;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      overflow: hidden;
      background-size: cover;
      text-align:center;
      height: 40px;
      width: 40px;
    }

    paper-icon-item {
      width: 100%;
      height: 100%;
    }

    .blue {
      background-color: var(--paper-light-blue-300);
    }
    .red {
      background-color: var(--paper-red-300);
    }
    .amber {
      background-color: var(--paper-amber-300);
    }
    .green {
      background-color: var(--paper-green-300);
    }

  </style>

  <template>
    <glg-current-user username="{{username}}" user="{{user}}">
    </glg-current-user>

    <paper-icon-item>
      <div item-icon>
        <template is="dom-if" if="{{user}}">
          <avatar class$="{{color}}" style$="{{_getBackgroundImage(imageUri)}}">
            <template is="dom-if" if="{{!imageUri}}">
              <span>[[initials]]</span>
            </template>
          </avatar>
        </template>
      </div>

      <content></content>
    </paper-icon-item>

    <iron-ajax
      auto
      id="xhr"
      handle-as="arraybuffer"
      on-response="_setImage"
      url="[[imageUrl]]"
      debounce-duration="300"></iron-ajax>

  </template>
</dom-module>

<script src="./glg-avatar.coffee"></script>